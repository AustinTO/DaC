<!-- Parent keys off program_name fail2ban and the 'actions' marker in the body -->
<decoder name="f2b-actions">
  <program_name>^fail2ban$</program_name>
  <prematch>fail2ban.actions</prematch>
</decoder>

<!-- Child extracts: service (jail), status (Ban|Unban), srcip (IPv4/IPv6) -->
<decoder name="f2b-actions-child">
  <parent>f2b-actions</parent>
  <regex type="pcre2">\[([^\]]+)\]\s+(Ban|Unban)\s+(\S+)</regex>
  <order>service,status,srcip</order>
</decoder>
<decoder name="f2b-filter">
  <program_name>^fail2ban$</program_name>
  <prematch>fail2ban.filter</prematch>
</decoder>

<!-- Extract service, srcip, and the timestamp after the hyphen -->
<decoder name="f2b-filter-child">
  <parent>f2b-filter</parent>
  <regex type="pcre2">\[([^\]]+)\]\s+Found\s+(\S+)\s+-\s+(.+)$</regex>
  <order>service,srcip,event_time</order>
</decoder>
<decoder name="f2b-server-start">
  <program_name>^fail2ban$</program_name>
  <prematch>fail2ban.server</prematch>
</decoder>

<!-- Capture the version string -->
<decoder name="f2b-server-start-child">
  <parent>f2b-server-start</parent>
  <regex type="pcre2">Starting\s+Fail2ban\s+v([0-9.]+)</regex>
  <order>version</order>
</decoder>
<decoder name="f2b-server-stop">
  <program_name>^fail2ban$</program_name>
  <prematch>fail2ban.server</prematch>
</decoder>

<decoder name="f2b-server-stop-child">
  <parent>f2b-server-stop</parent>
  <regex type="pcre2">Exiting\s+Fail2ban</regex>
  <order>stopped</order>
</decoder>
